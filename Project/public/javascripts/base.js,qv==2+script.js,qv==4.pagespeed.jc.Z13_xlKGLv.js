var mod_pagespeed_1a3lV5j7kF = "function hslToRgb(h,s,l){var m1,m2,hue;var r,g,b\nif(s==0)\nr=g=b=(l*255);else{if(l<=0.5)\nm2=l*(s+1);else\nm2=l+s-l*s;m1=l*2-m2;hue=h/360;r=HueToRgb(m1,m2,hue+1/3);g=HueToRgb(m1,m2,hue);b=HueToRgb(m1,m2,hue-1/3);}\nreturn[Math.round(r),Math.round(g),Math.round(b)];}\nfunction HueToRgb(m1,m2,hue){var v;if(hue<0)\nhue+=1;else if(hue>1)\nhue-=1;if(6*hue<1)\nv=m1+(m2-m1)*hue*6;else if(2*hue<1)\nv=m2;else if(3*hue<2)\nv=m1+(m2-m1)*(2/3-hue)*6;else\nv=m1;return 255*v;}\nfunction RemainingTime(time){this.time=time;};RemainingTime.minute=60000;RemainingTime.second=1000;RemainingTime.format=function(time){var obj=new RemainingTime(time);return obj.toString();};RemainingTime.prototype.getSeconds=function(){return Math.ceil((this.time%RemainingTime.minute)/RemainingTime.second);};RemainingTime.prototype.getMinutes=function(){return Math.floor(this.time/RemainingTime.minute);};RemainingTime.prototype.toString=function(){var minutes=this.getMinutes();if(minutes>0)\nreturn this.getMinutes()+\"m \"+this.getSeconds()+\"s\";return this.getSeconds()+\"s\";};function notifyParent()\n{if(!('QuizData'in window)||!('postMessage'in window)){return;}\ntop.postMessage({width:$(\"body\").width(),height:$(\"body\").height(),type:QuizData[0],id:QuizData[1]},'*');}\nfunction initRankingForm(checkEmailUrl){var $tabs=$('.scoreform');var newTabIndex=$('.ui-tabs-nav li').size()==2?0:1;$tabs.tabs({select:function(event,ui){$('#player1 input[type=\"password\"]').val('');$('#player1 .createpw').hide();if(ui.index==newTabIndex){$('#player1 fieldset:first').show();}\nelse if(ui.index==newTabIndex+1){$('#player0').hide();$('#firsttab').hide();$('.ui-tabs-nav li:last').show();}\nvar $login=$('#loginbutton');var $forgot=$('#forgotpasswordbutton');$login.show();$forgot.hide();$login.insertBefore($forgot);$('#RankingFormModel_login_password').parent().show();$('#RankingFormModel_login_password').val('');}});$('input[type=\"email\"]').change(function(){$('input[type=\"email\"]').val($(this).val());});var $email=$('#RankingFormModel_email');$email.blur(function(){if($(this).val()!=''&&$(this).is(':visible')){$.get(checkEmailUrl+$(this).val(),function(response){if(response){$tabs.tabs('select',newTabIndex+1);$('#RankingFormModel_password').focus();$email.data('new',0);}\nelse{$email.data('new',1);if($email.parent().hasClass('success')&&$email.parent().next().hasClass('success')){showPw();}}});}});$('input[name=\"new\"]').click(function(){$email.blur();});$('#forgotpw').click(function(){$(this).parents('div:first').hide();$('#RankingFormModel_login_password').val('');var $login=$('#loginbutton');var $forgot=$('#forgotpasswordbutton');$forgot.show();$login.hide();$forgot.insertBefore($login);return false;});$('#changeuser').click(function(){$tabs.tabs('select',newTabIndex+1);return false;});}\nfunction showPw(){$(\".createpw\").show();$('#player1').find(\"fieldset:first\").hide();$('#player1 input[type=\"password\"]').val('');}\nfunction initLogin(){$('#forgotpw').click(function(event){$(this).closest('form').hide();event.preventDefault();$('#forgotpwcontainer').removeClass('hidden');});}\nfunction initCountdown(){var counter=5;var $timeProgress=$('.progress > .bar');$timeProgress.css('width','0%');var interval=setInterval(function(){counter--;$('.counter').toggleClass('blink');$('.counter').text(counter);if(counter==0){$('h1').text('GO! GO! GO!');window.location+='&countdown=true';clearInterval(interval);return;}},1000);var barProgress=counter*40;var barTotal=barProgress;var barInterval=setInterval(function(){if(barProgress>0){--barProgress;var progress=((barTotal-barProgress)/barTotal)*100;$timeProgress.css('width',progress+'%');var h=(89-2)*(progress/100)+2;var colors=hslToRgb(h,1,0.64);$timeProgress.parent().css('background-color','rgb('+colors.join(',')+')');}},25);}\nfunction initRankingTabs(){var $tabs=$(\"#rankingtabs\");$tabs.tabs();if('onhashchange'in window){$(window).on('hashchange',function(){var tab=$(location.hash).prevAll('.ui-tabs-panel').length;$tabs.tabs('option','active',tab);});}\nelse{$tabs.on('click','.tinytabs a',function(ev){ev.preventDefault();var hash=/#.*/.exec(this.href)[0];var tab=$(hash).prevAll('.ui-tabs-panel').length;$tabs.tabs('option','active',tab);});}}\nfunction initRankingAccordion(){$(\".teamtab\").tabs({});};function initRankingNodigUit(){$('a.friends').click(function(e){e.preventDefault();$('.challengefriends').show().insertAfter($(this).parents('.scoreactions:first'));});}\nfunction initRankingLoader(options){$button=$(\"#rankingSelectButton\");$list=$(\"#rankingSelectList\");$container=$(\"#rankingContainer\");$button.on('click',function(){$container.load(options.url+'&round='+$list.val())});}\nfunction initRankingFilters(){$(\".ranking-filter\").each(function(){$this=$(this);var inputs=$this.find('select, input:not([type=submit]):not([type=button]), textarea');var baseUrl=$this.data('url');var replace=$this.next('table').wrap(document.createElement('div')).parent();$this.find('button,input[type=submit],input[type=button]').on('click',function(){var url=baseUrl;inputs.each(function(){url+='&'+encodeURIComponent(this.name)+\"=\"+encodeURIComponent(this.value);});replace.load(url);});});};function owlyBlink(){var randSeconds=Math.ceil(Math.random()*5)+2;var randDelay=randSeconds*300;var speed=300;var owly=$('.owly');setTimeout(function(){owly.toggleClass('active');owlyBlink();},randDelay);}\nfunction chooseIframeSize(selector){$('#customdiv').hide();var videoSize=$('#iframe-options');var textarea=$(selector);var customWidth=$('#customwidth');var customHeight=$('#customheight');videoSize.change(function(){$(\"#iframe-options option:selected\").each(function(){if($(this).val()=='custom'){$('#customdiv').show();}\nelse{$('#customdiv').hide();var newWidth=$(this).attr('data-width');var newHeight=$(this).attr('data-height');updateSize(newWidth,newHeight);}});});var updateSize=function(width,height){textarea.each(function(){var val=this.value;if(width){val=val.replace(/width=\"[^\"]+\"/g,'width=\"'+width+'\"');}\nif(height){val=val.replace(/height=\"[^\"]+\"+/g,'height=\"'+height+'\"');}\nthis.value=val;});};customWidth.keyup(function(){updateSize($(this).val().replace(/[^0-9]/g,''),null);});customHeight.keyup(function(){updateSize(null,$(this).val().replace(/[^0-9]/g,''));});}\n(function($){$.fn.quiz=function(options){this.data('quiz',new Quiz(this,options));return this;}\n$.fn.assessment=function(options){this.data('quiz',new Assessment(this,options));return this;}\n$.fn.exam=function(options){this.data('quiz',new Exam(this,options));return this;}})(jQuery);(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\\b_super\\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]==\"function\"&&typeof _super[name]==\"function\"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}\nfunction Class(){if(!initializing&&this.init)\nthis.init.apply(this,arguments);}\nClass.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class;};})();var AbstractQuiz=Class.extend({init:function($container,options){this.options=options;this.$container=$container;this.$form=$(options.selectors.questionForm,this.$container);this.$questionNumber=$(options.selectors.questionNumber);this.options=options;this.$questionNumber.html(options.labels.question.replace(/{number}/,options.questionNumber));this.questionNumber=options.questionNumber;this.expectAnswers=1;var quiz=this;this.$form.on('submit',function(ev){ev.preventDefault();''\nquiz.answer(null);});this.$form.on('change','.autosubmit input[type=\"radio\"], .autosubmit input[type=\"checkbox\"]',function(event){if(!$container.hasClass('loading')){$(this).closest('li')[this.checked?'addClass':'removeClass']('pressed');quiz.answer($(this));}});this.$form.on('change','.autosubmit',function(){if(!$container.hasClass('loading')){quiz.answer(null);}});this.$form.on('click','label img',function(ev){var inputId=$(this).closest('label').attr('for');$('#'+inputId).prop('checked',true).change();});window.setInterval(function keepAlive(){quiz.keepAlive();},300000);var me=this;if('setImmediate'in window)\nwindow.setImmediate(function(){me.nextQuestion();});else\nwindow.setTimeout(function(){me.nextQuestion();},0);},nextQuestion:function(){if(this.options['mobile']){$('.ribbon').removeClass('wrong correct');}\nthis.$container.addClass('loading');$.ajax({dataType:'json',url:this.options.questionUrl,context:this}).then(this.validateResponse).then(this.updateQuestion,this.quizError);},updateQuestion:function(data){this.$form.html(data.question);this.$questionNumber.html(this.options.labels.question.replace(/{number}/,data.number));this.$container.removeClass('loading');this.questionNumber=data.number;this.expectAnswers=(data.expectAnswers)?data.expectAnswers:1;if(window.notifyParent){window.notifyParent();}},answer:function($radio){if(this.expectAnswers>1)\n{var answers=$.grep(this.$form.serializeArray(),function(element){return element.name=='answer[]';});if(answers.length<this.expectAnswers)\nreturn;}\nthis.$container.addClass('loading');this.$selectedAnswer=$radio;$.ajax({type:\"POST\",url:this.$form.attr('action'),data:this.$form.serialize(),context:this,dataType:'json'}).then(this.validateResponse).then(this.updateAnswer,this.quizError);},validateResponse:function(data){if(!data||typeof data!==\"object\"){return(new $.Deferred()).rejectWith(this);}\nreturn(new $.Deferred()).resolveWith(this,[data]);},updateAnswer:function(data){if(this.$selectedAnswer){this.$selectedAnswer.closest('li').find('.question-progress').html(data.questionProgress);}\nif(data.reloadQuestion)\n{this.nextQuestion();return;}\nif(data.feedback){this.feedback(data.feedback);}\nelse{this.afterUpdateAnswer(data);}},feedback:function(feedback)\n{var me=this;this.$form.html(feedback);this.$container.removeClass('loading');$('.continue',this.$form).click(function(e){e.preventDefault();me.afterUpdateAnswer();});$('.loadinline',this.$form).click(function(e){e.preventDefault();$.ajax({url:this.href,dataType:'json',}).then(function(data){me.updateAnswer(data);});});if(window.notifyParent){window.notifyParent();}},afterUpdateAnswer:function(data){var quiz=this;data=data||{hasEnded:false};if(data.hasEnded){setTimeout(function(){location=quiz.options.rankingUrl;},1000);}\nelse{if(typeof data.askNext==\"undefined\"||data.askNext)\n{setTimeout(function(){quiz.nextQuestion.call(quiz);},1000);}\nelse{this.$container.removeClass('loading');}}},keepAlive:function(){$.get(this.options.keepAliveUrl);},quizError:function(){location=this.options.rankingUrl;}});var Assessment=AbstractQuiz.extend({init:function($container,options){this._super($container,options);this.$progress=$(options.selectors.progress);style='width:'+(100/options.questionCount)+'%;';for(var i=0;i<options.questionCount;++i){$('<div></div>',{style:style,'class':i<options.questionNumber-1?'complete':null}).appendTo(this.$progress);}},updateQuestion:function(data){var index=(data.number-2);if(index>=0){$('div:eq('+index+')',this.$progress).addClass('complete');}\nthis._super(data);},updateAnswer:function(data){if(this.$selectedAnswer){this.$selectedAnswer.parents('li:first').addClass('pressed');}\nif(data.bestAnswer){$('li:eq('+(data.bestAnswer-1)+')',this.$form).addClass('correct');}\nif(data.description){var quiz=this;setTimeout(function(){var description=quiz.options.descriptionTemplate.replace(/\\{([a-z_0-9]+)\\}/ig,function(match,field){return data[field]||'';});var header=$(quiz.$form).find('header');header.nextAll().remove();header.after(description);$('a',quiz.$form).click(function(e){e.preventDefault();if(data.hasEnded){location=quiz.options.rankingUrl;}\nelse{quiz.nextQuestion.call(quiz);}});},1000);}\nelse{this._super(data);}}});var Quiz=AbstractQuiz.extend({init:function($container,options){this._super($container,options);this.$timeLeftover=$(options.selectors.timeLeftover);this.$timeProgress=$(options.selectors.timeProgress);this.$score=$(options.selectors.score);this.$timeColor=$(options.selectors.timeColor);this.$scoreChange=$(options.selectors.scoreChange);this.$timeChange=$(options.selectors.timeChange);var quiz=this;this.timer=$.timer(function(data){quiz.updateTimer.call(quiz,data);},50,false);this.$score.html(options.score);this.updateTimer(options.timeRemaining);if(!this.options['mobile']&&self==top){$(window).on('blur',function(){$(\".gameisrunning\").show();});$(\".gameisrunning\").click(function(e){e.preventDefault();quiz.nextQuestion();$(this).hide();});}},updateQuestion:function(data){this._super(data);this.updateTimer(data.time);if(!this.timer.isActive){this.timer.play();}},updateTimer:function(timeRemaining){if(timeRemaining===undefined){timeRemaining=this.$timeLeftover.data('value')-this.timer.intervalTime;}\nif(timeRemaining<=0){location=this.options.rankingUrl;this.timer.stop();return;}\nvar progress=(timeRemaining/this.options.startTime)*100;this.$timeLeftover.data('value',timeRemaining);var date=new RemainingTime(timeRemaining);var showLeftover=date.getSeconds()+'s';if(date.getMinutes()){showLeftover=date.getMinutes()+'m '+showLeftover;}\nthis.$timeLeftover.html(RemainingTime.format(timeRemaining));this.$timeProgress.css('width',progress+'%');var h=(89-2)*(progress/100)+2;var colors=hslToRgb(h,1,0.64);this.$timeColor.css('background-color','rgb('+colors.join(',')+')');},updateAnswer:function(data){this.updateTimer(data.time);this.$score.html(data.score);if(data.timeBonusAdded>0){this.$timeChange.html('+ '+data.timeBonusAdded+'s');}\nelse{this.$timeChange.html('');}\nif(data.scoreAdded>0){this.$scoreChange.html('+ '+data.scoreAdded);if(this.options['mobile'])\n$('.ribbon').addClass('correct');}\nelse{this.$scoreChange.html('');if(this.options['mobile'])\n$('.ribbon').addClass('wrong');}\nif(this.$selectedAnswer){this.$selectedAnswer.parents('li:first').addClass(data.correct?'correct':'wrong');}\nif(this.timer.isActive){this.timer.stop();}\nthis._super(data);}});var Exam=AbstractQuiz.extend({init:function($container,options){var exam=this;this._super($container,options);this.$prev=$(options.selectors.prevQuestion,$container);this.$next=$(options.selectors.nextQuestion,$container);this.$pointsContainer=$(options.selectors.pointsContainer);this.expectLength=1;this.givenAnswers=[];$questionIndex=this.$questionIndex=$(options.selectors.questionIndex,$container);if(!options.allowNavigation){this.$prev.remove();this.$next.remove();}\nelse{this.$prev.hide().click(function(e){e.preventDefault();exam.jumpToQuestion(exam.questionNumber-1);});this.$next.hide().click(function(e){e.preventDefault();exam.jumpToQuestion(exam.questionNumber+1);});$('span:lt('+options.lastQuestionNumber+')',$questionIndex).wrapInner(function(){return'<a href=\"#\" class=\"jump\"></a>';}).removeClass(\"disabled\");}\nif(options.timer){this.$timeLeftover=$(options.selectors.timeLeftover,$container);this.$timeContainer=$(options.selectors.timeContainer,$container);this.$timeContainer.addClass(options.timer.type);this.timer=$.timer(function(data){exam.updateTimer.call(exam,data);},50,false);this.updateTimer(options.timer.timeRemaining);}\nthis.$questionIndex.on('click','a',function(e){e.preventDefault();exam.jumpToQuestion(parseInt($(this).html(),10));});},jumpToQuestion:function(number){$.ajax({dataType:'json',url:this.options.jumpToQuestionUrl,data:{index:number-1},success:function(response){if(response.success){this.nextQuestion();}},context:this});},answer:function($radio){if($radio){if(!this.options.allowFeedback){$radio.parents('li:first').addClass('pressed');}\n$radio.parents('li:first').addClass('pressed');}\nthis._super($radio);},updateQuestion:function(data){this._super(data);this.expectLength=data.expectAnswers||1;this.givenAnswers=[];this.$pointsContainer.html(data.points);if(this.options.allowNavigation){$('span:lt('+data.number+')',$questionIndex).filter('.disabled').wrapInner(function(){return'<a href=\"#\" class=\"jump\"></a>';}).removeClass(\"disabled\");if(data.lastNumber>data.number){this.$next.show();}\nelse{this.$next.hide();}\nif(data.number>1){this.$prev.show();}\nelse{this.$prev.hide();}}\nthis.updateTimer(data.time);if(this.timer!=undefined&&!this.timer.isActive){this.timer.play();}},updateAnswer:function(data){this._super(data);this.updateTimer(data.time);var $span=$('span:eq('+(data.number-1)+')',$questionIndex);$span.addClass('answered');if(data.correct!=undefined){if(data.correct){$span.removeClass('incorrect').addClass('correct');}\nelse{$span.removeClass('correct').addClass('incorrect');}\nif(this.$selectedAnswer){this.$selectedAnswer.parents('li:first').addClass(data.correct?'correct':'wrong');}}\nif(this.timer!=undefined&&this.timer.isActive){this.timer.stop();}},updateTimer:function(timeRemaining){if(this.timer!=undefined){if(timeRemaining===undefined){timeRemaining=this.$timeLeftover.data('value')-this.timer.intervalTime;}\nif(timeRemaining<=0){if(this.options.timer.type=='exam'){location=this.options.rankingUrl;this.timer.stop();}\nelse{}\nreturn;}\nthis.$timeLeftover.data('value',timeRemaining);var progress=(timeRemaining/this.options.timer.startTime)*100;progress=Math.round(progress/12.5);this.$timeContainer.removeClass().addClass('time_'+progress);this.$timeLeftover.html(RemainingTime.format(timeRemaining));}},});$(function onQuizLoad(){if(self!=top){$('html').addClass('iniframe');}\nnotifyParent();$('.fblogin,.facebbutton').click(function(e){e.preventDefault();var url=$(this).attr('href');FB.login(function(response){if(response.status=='connected'){window.location=url;}},{scope:'email'});});var hasSession=/\\bPHPSESSID\\=[A-Za-z0-9]+\\b/.test(document.cookie);if(!hasSession&&!/[&?]safari\\=/.test(location.search)&&!/[&?]PHPSESSID=/.test(location.search)){var newLocation=location.href+(/\\?/.test(location.href)?'&':'?')+'safari=1';location.replace(newLocation);}});";
var mod_pagespeed_BJxTPQBjCJ = "(function($){$.fn.equalHeights=function(){var max=0;this.each(function(){if($(this).height()>max){max=$(this).height();}});return this.each(function(){$(this).height(max);});}\nvar $menuBar=$('.menubar');var $pageHeader=$('.pageheader');var offset=$menuBar.offset();var sticky_navigation_offset_top=offset?offset.top:0;var sticky_navigation=function(){var scroll_top=$(window).scrollTop();if(scroll_top>sticky_navigation_offset_top&&$(window).width()>=960){$menuBar.css({'position':'fixed','top':0,'left':0});$pageHeader.css({'margin-top':'50px'});}else{$menuBar.css({'position':'relative'});$pageHeader.css({'margin-top':'0'});}};sticky_navigation();$(window).scroll(function(){sticky_navigation();});if($('.dropdownify').length!=0){$('.dropdownify').each(function(){$(this).children($('.dropdowntitle')).click(function(e){console.log($(this).next('.dropdownblock'));$(this).next('.dropdownblock').show();$(this).parent().addClass('opened');e.stopPropagation();});});$(\"html\").click(function(){$('.dropdownify.opened').children('.dropdownblock').hide()\n$('.dropdownify.opened').removeClass('opened');});}})(jQuery);$(function(){if($(window).width()>=768){$('.equal1').equalHeights();$('.equal2').equalHeights();$('.equal3').equalHeights();}});function initCategoriesUpdate(options){var $container=$('.categoriecontainer');var $inputContainer=$('.inputs',$container);var updateRemoveButtons=function(){$remove=$('.inputs > .row',$container);if($remove.length>2){$remove.find(\".remove\").show();}\nelse{$remove.find(\".remove\").hide();}}\nvar tinyMCE=function(){initTinyMCEField($(this));};var imageUpload=function(){var $this=$(this);var fileuploadOptions=options.fileupload;fileuploadOptions.$filesContainer=$('.filescontainer',$(this));initFileupload($this,fileuploadOptions);};$('.add',$container).click(function(e){e.preventDefault();var toAppend=$.parseHTML(options.inputTemplate);$inputContainer.append(toAppend);$(toAppend).find('.input-image').each(imageUpload);$(toAppend).find('.tinymce').each(tinyMCE);updateRemoveButtons();});$container.on('click','.remove',function(e){e.preventDefault();$(this).parents('div.row:first').remove();updateRemoveButtons();});updateRemoveButtons();$('.input-image').each(imageUpload);$('.tinymce').each(tinyMCE);}\nfunction initCategoriesSliders(){};function initAssessmentQuestion(template,options){var $container=$('#assessmentquestionmodel, #editassessmentquestionformmodel');var newOptions='';$container.on('click','.tinyadd',function(e){e.preventDefault();var replaced=template.replace(/{n}/g,$(this).data('n')).replace(/{id}/g,Math.random().toString(36).substring(7)).replace(\"</select>\",newOptions+\"</select>\");$(this).parents('.categories:first').find('.items').append(replaced);});$container.on('click','.remove',function(e){e.preventDefault();$(this).parents('.row:first').remove();});var $dialog=$('form.createcategoryform');$dialog.dialog({autoOpen:false,modal:true,draggable:false,width:'auto',height:'auto',maxWidth:600,modal:true,});$('.createcategory').on('click',function(e){e.preventDefault();var html='<ul>';$('.categoryselect:first option:not(:first)').each(function(){html+='<li>'+$(this).html()+'</li>';});html+='</ul>';$('.dialogcategories').html(html);$dialog.dialog(\"option\",\"title\",$(this).attr('title'));$dialog.dialog('open');$('.ui-dialog-content').height(($('.ui-dialog').innerHeight()-90)+'px');var offset=$('.ui-dialog-content input[type=\"submit\"]').offset();if(offset){$('.ui-dialog-content').animate({scrollTop:offset.top},1000);}});$dialog.submit(function(e){e.preventDefault();$dialog.addClass('loading');$.getJSON($dialog.attr('action'),{title:$('[name=\"title\"]',$dialog).val(),content:$('[name=\"content\"]',$dialog).val()},function(result){if(result.success){$('.categoryselect').append(result.option);newOptions+=result.option;$('input[type=text]',$dialog).val('');$('[name=\"content\"]',$dialog).html('')\n$dialog.dialog('close');$dialog.removeClass('loading');}});});}\nfunction initQuestions(options){var $spans=$('.radiocontainer span.ir');var $fieldsContainer=$('.fieldscontainer');var $inputs=$('.fieldscontainer > div');var $corrAm=$(\"#QuestionModel_correct_amount\");var _updateCorrect=function(){};for(i=0;i<options.fields.length;++i){var field=options.fields[i];var rx=new RegExp('{'+field+'}','g');for(j=0;j<options.templates.length;++j){options.templates[j]=options.templates[j].replace(rx,'<span class=\"tmp_'+field+'\"></span>');}}\nfor(i=0;i<options.templates.length;i++){options.templates[i]=options.templates[i].replace(/{[A-Za-z0-9]+}/g,'');}\nvar getAnswers=function(fn){return $(\".createanswers input, .createanswers textarea\").filter(function(){return/answer/.test(this.id);}).slice(4).map(function(){$closest=$(this).closest('.answer');return $closest.length?$closest[0]:this;}).add(\".moreanswerfield\");};$('.radiocontainer .questiontype input:radio').change(function(){$spans.removeClass('active');$('span.ir',$(this).parent()).addClass('active');$fieldsContainer.append($inputs);$('fieldset.createanswers').remove();$fieldsContainer.after(options.templates[$(this).val()]);for(i=0;i<options.fields.length;++i){var field=options.fields[i];$('span.tmp_'+field).replaceWith($('[data-field=\"'+field+'\"]',$fieldsContainer));}\n$('.question_image canvas').each(function(){$(this).width($(this).parents('.question_image').outerWidth());$(this).height($(this).parents('.question_image').outerHeight());});$questionsField=$('fieldset:not(.radiocontainer)');if(!options.allowImages&&this.value>0){$(\".upgradecta\").show();$questionsField.find('.fileinput-button').addClass('disabled');$(\"#QuestionModel_question\").attr('disabled','disabled');$questionsField.find('input').attr('disabled','disabled');$questionsField.find('input, textarea, select').attr('disabled','disabled');}\nelse{$(\".upgradecta\").hide();$questionsField.find('.fileinput-button').removeClass('disabled');$(\"#QuestionModel_question\").attr('disabled',false);$questionsField.find('input, textarea, select').attr('disabled',false);}\n_updateCorrect();if($(\"#QuestionModel_answer_5, #AssessmentQuestionModel_answer_5, #ExamQuestionModel_answer_5\").val()==''){getAnswers().hide();$(\"#moreAnswers\").show();}\nelse{$(\"#moreAnswers\").hide();}}).filter(':checked').trigger('change');if($corrAm.length)\n{_updateCorrect=function(){var _val=+$corrAm.val();var qs=$(\"#answers\").children(\"div\");var h2=$(\"#wrongAnswersHeader\");qs.eq(_val-1).after(h2);var getLabel=function(index,length){length=length||4;if(index>=_val){return(_val===length-1)?options.wrongText:options.wrongText+\" \"+((index-_val)+1);}\nelse{return(_val===1)?options.correctText:options.correctText+\" \"+(index+1);}};var ll=$(\".title-label\");ll.each(function(index){$(this).text(getLabel(index,ll.length));});var ll=$(\"input\").filter(function(){return/answer/.test(this.id);});ll.each(function(index){$(this).attr('placeholder',getLabel(index,ll.length));});};}\n$corrAm.change(_updateCorrect);_updateCorrect();$(\".createanswers\").parent().on('click',\"#moreAnswers\",function(ev){ev.preventDefault();getAnswers().show();$(this).hide();});initImageUpload(options);}\nfunction initAssessmentOptionsQuestion(options){var addButton=$(\"#addOption\");var container=$(\"#optioncontainer\");var getOptionCount=function(){var numbers=$.map(container.children('.answer'),function(item){return+$(item).data('index');});if(!numbers.length){return 1;}\nreturn Math.max.apply(Math,numbers)+1;};var getCategoryCount=function(categories){var numbers=$.map(categories.children('div'),function(item){return+$(item).data('index');});if(!numbers.length){return 1;}\nreturn Math.max.apply(Math,numbers)+1;};var addItem=function(addCategory){var i=getOptionCount();var newInstance=$($.parseHTML(options.templates.option.replace(/\\{i\\}/g,i)));newInstance.data('index',i);if(addCategory){addCategoryOption(newInstance);}\ncontainer.append(newInstance);return newInstance;};var addCategoryOption=function(category){var container=$(category).find('.categories');var i=category.data('index');var j=getCategoryCount(container);var newInstance=$($.parseHTML(options.templates.categories.replace(/\\{i\\}/g,i).replace(/\\{j\\}/g,j)));newInstance.data('index',i);container.append(newInstance);return newInstance;};container.on('click','.remove',function(ev){ev.preventDefault();$(this).closest('.answer').remove();});addButton.on('click',function(ev){ev.preventDefault();addItem(true);});var searchInput=function(context,name){return $(context).find('input[name], select[name], textarea[name]').filter(function(){return(this.name.indexOf('['+name+']')!==-1);});};for(var i=0;i<options.items.length;i++){var newItem=addItem(false);var catData=options.items[i];searchInput(newItem,'answer').val(catData.answer);searchInput(newItem,'id').val(catData.id);var to=Math.min(catData.scores.length,catData.categories.length);for(var j=0;j<to;j++){var catItem=addCategoryOption(newItem);searchInput(catItem,'categories').val(catData.categories[j]);searchInput(catItem,'scores').val(catData.scores[j]);}\nif(to===0){addCategoryOption(newItem);}}};function initFileupload($object,options){var $this=$object;var $fileInput=$this.find('input[type=file]');var $hiddenInput=$this.find('input[type=hidden]');var $deletBtn=$this.find(\".img-delete\");var type='_'+$fileInput.attr('name').match(/\\[([^\\]]+)\\]/)[1];var $filesContainer=options.$filesContainer==undefined?$('#files'+type):options.$filesContainer;$fileInput.fileupload({dropZone:$this,dataType:'json',url:options.uploadUrl,autoUpload:true,acceptFileTypes:/(\\.|\\/)(gif|jpe?g|png)$/i,maxFileSize:5000000,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),previewCrop:true,previewThumbnail:false,multipart:true,singleFileUploads:true,maxNumberOfFiles:1,limitMultiFileUploads:1,filesContainer:$filesContainer,replaceFileInput:false}).on('fileuploadadd',function(e,data){$fileInput.fileupload('option','previewMaxWidth',$filesContainer.parent().width());$fileInput.fileupload('option','previewMaxHeight',$filesContainer.parent().height());$filesContainer.empty();data.context=$('<div/>').appendTo($filesContainer);$.each(data.files,function(index,file){var node=$('<p/>').append($('<span/>'));if(!index){node.append('<br>');}\nnode.appendTo(data.context);});}).on('fileuploadprocessalways',function(e,data){$fileInput.val('');var index=data.index,file=data.files[index],node=$(data.context.children()[index]);if(file.preview){node.prepend('<br>').prepend(file.preview);}\nif(file.error){node.append('<br>').append($('<span class=\"text-danger\"/>').text(file.error));}\nif(index+1===data.files.length){data.context.find('button').text('Upload').prop('disabled',!!data.files.error);}}).on('fileuploaddone',function(e,data){if(!data.result[0]){return;}\nif(data.result[0].error){var error=$('<span class=\"errorMessage\">').text(data.result[0].error);$fileInput.parent().after(error);$hiddenInput.val('');$fileInput.val('');return;}\n$hiddenInput.val(data.result[0].filename).trigger('change');$deletBtn.show();});$deletBtn.on('click',function(ev){ev.preventDefault();$hiddenInput.val('').trigger('change');$filesContainer.empty();$deletBtn.hide();});}\nfunction initImageUpload(options){if($('html').hasClass('oldie')){return;}\n$('.input-image').each(function(){var $this=$(this);var $fileInput=$this.find('input[type=file]');initFileupload($this,{uploadUrl:options.baseUrl+'/index.php?r=manage'+options.type+'/uploadImage&fieldName='+encodeURIComponent($fileInput.attr('name'))});});}\nfunction initSortableQuestionsIndex(options){var $container=$(\"table.items tbody\");$container.sortable({helper:function(e,ui){ui.children().each(function(){$(this).width($(this).width());});return ui;},update:function(){var data=$container.sortable('serialize',{key:'items[]',attribute:'class'});$.ajax({url:options.url,type:'post',data:data,success:function(){var number=1;$('tr td:first-child',$container).each(function(){$(this).html(number++);});},error:function(){alert(options.error);}})}});}\nfunction initStatsPage(okTxt,cancelTxt){var $dialog=$(\"#confirm-cleanup\");var $link=$(\"#confirm-cleanup-link\");var buttons={};buttons[okTxt]=function(){$form=$('#RankingSelectionForm');$form.attr('action',$link[0].href).submit();$(this).dialog(\"close\");};buttons[cancelTxt]=function(){$(this).dialog(\"close\");};$dialog.dialog({resizable:false,height:140,autoOpen:false,modal:true,buttons:buttons});$link.on('click',function(ev){ev.preventDefault();$dialog.dialog('open');});}\nfunction initQuizSettingsUpdate(options){$(\".colorpickercontainer input\").spectrum(options.spectrum);if(options.settingGroups){$(\"#tabs\").tabs();$(\"#tabs\").on(\"focus\",\"input\",function(ev){var before=$(this).closest(\".contentbox\").parent().prevAll(\"div\").length;$(\"#tabs\").tabs(\"option\",\"active\",before);});}\nif(options.image){initImageUpload(options.image);}\nvar box=$(\"#QuizModel_enable_challenge_a_friend\");if(box.length){var fields=$(\"#QuizModel_challenge_a_friend_message, #QuizModel_challenge_a_friend_subject\").parent();var _updateField=function(){fields[box[0].checked?'show':'hide']();};box.on('change',_updateField);_updateField();};$(\"#QuizModel_share_facebook, #AssessmentModel_share_facebook, #ExamModel_share_facebook\").change(function(){var func=this.checked?'show':'hide';$(\".share_facebook_image\")[func]();}).change();$(\".extrasettingintro\").each(function(){var intro=$(this);var related=intro.next('.extrasettings');var checkbox=intro.find('.checkboxfield input');checkbox.prop('checked',!!related.find('input, textarea').filter(function(){return!!this.value;}).length);checkbox.on('change',function(){related[this.checked?'show':'hide']();}).trigger('change');});var error=$(\"#tabs .errorMessage:not(.hide)\").eq(0);if(error.length){var index=error.closest(\".ui-tabs-panel\").prevAll(\".ui-tabs-panel\").length;$(\"#tabs\").tabs(\"option\",\"active\",index);}\nvar colorMap={backgroundColor:options.modelName+'_color_background',lightColor:options.modelName+'_color_light_color',primaryColor:options.modelName+'_color_primary_color',primaryText:options.modelName+'_color_primary_text',subColor:options.modelName+'_color_sub_color'};$(\"#\"+options.modelName+\"_stylesheet\").on('change',function(){var defaults=options.defaultColors[this.value];for(var key in defaults){if(!(key in colorMap)){continue;}\nconsole.log(defaults[key]);var field=document.getElementById(colorMap[key]);$(field).spectrum('set',defaults[key]);}});}\nfunction initSettingsPlayerInfo(options){var playField=$(\"#QuizModel_account_askfields\");var playGroups=['profile','player','player'];var playInitVal=playGroups[playField.val()];var warning=$(\"#accountRankingWarning\");warning.hide();playField.change(function(){warning[playGroups[playField.val()]!=playInitVal?'show':'hide']();});$(\"#\"+options.model+\"_account_requirement\").change(function(){var fn=this.value!=1?'show':'hide';$(\".extrainfocontainer\")[fn]();}).change();$(\".requiredplayerinfo select\").change(function(){var classNames=options.classMap[this.value];this.parentNode.className='selectfield '+classNames;}).change();};function initSettingsMoreFields(containers){$(containers).each(function(){var container=$(this);var fields=container.children('div');var button=container.find('.button');for(var i=fields.length-1;i>0;i--){var field=fields.eq(i);if(field.find('input').filter(function(){return!!this.value}).length)\nbreak;}\nvar index=i+1;for(var i=index;i<fields.length;i++){fields.eq(i).hide();}\nvar fnBtnHide=function(){if(index==fields.length){button.hide();}}\nbutton.on('click',function(ev){ev.preventDefault();fields.eq(index).show();index++;fnBtnHide();});fnBtnHide();});};function initSettingsRequirements(options){};function initBehaviorConfig(model,behavior){var $enableCheckBox=$(\"#\"+model+\"_behavior_\"+behavior+\"_enable\");var $settingsContainer=$(\"#config_\"+behavior+\"_container\");$enableCheckBox.on('change',function(){$settingsContainer[this.checked?'show':'hide']();});$enableCheckBox.change();};function initQuestionsOveriew(options){$(\"#gridcontainer\").hide();$(\"#gridcontainer\").on('keypress','.filters input',function(ev){if(ev.which=='13'){ev.preventDefault();}});$(\"#gridcontainer\").on('change',\"#selectallcheckboxhierboven\",function(){$(\"#gridcontainer tbody input:not([disabled])\").prop('checked',this.checked);});var curQuiz=false;$(\"#QuestionsOverviewForm_quiz\").change(function(){updateQuizSelections(this.value);});function updateQuizSelections(currentId){var sCur=currentId+'';if(sCur){$(\"#gridcontainer\").show();$(\"#gridcontainer\").addClass('showgrid');}\n$(\"#gridcontainer tbody tr\").each(function(){var $me=$(this);var $input=$me.find('input');var quizzes=String($me.data('quizzes'));if(quizzes.split(/,/).indexOf(sCur)!==-1){$me.addClass('incurrentquiz');$input.prop('checked',true).prop('disabled',true);}\nelse{$me.removeClass('incurrentquiz');$input.prop('checked',false).prop('disabled',false);}});}\n$(\"#gridcontainer\").on('click','.showfullinfo',function(ev){ev.preventDefault();var row=$(this).closest('tr');var url=options.questionUrl.replace(/%7Bid%7D/g,row.data('id'))\n$(\"<div>\").load(url,function(){$(this).dialog({resizable:false,width:600,autoOpen:true,modal:true,title:options.dialogTitle,});});});$(\"#QuestionsOverviewForm_quiz\").change();};function initExamSettingsUpdate(){var $time=$('#ExamModel_time').parent();$('#ExamModel_time_limit').change(function(){if($(this).val()==0){$time.hide();}\nelse{$time.show();}}).trigger('change');var $numberOfAttempts=$('#ExamModel_number_of_attempts').parent();$('#ExamModel_type').change(function(){if($(this).val()==3){$numberOfAttempts.show();}\nelse{$numberOfAttempts.hide();}}).trigger('change');}\nfunction initExamQuestionIndex(options){if(options.allowRecycle){var $dialog=$(\"#import-dialog\").hide().dialog({modal:true,autoOpen:false,resizable:false,'max-height':'500px',width:'600px',title:options.title});$dialog.parent().css('max-width','600px');$(\".importquestion\").on('click',function(ev){ev.preventDefault();$.ajax({url:this.href,success:function(data){$dialog.html(data).dialog('open');}});});}};function initUpdateAssessmentQuestionDescription(){var $description=$('#desc_fields');$('#AssessmentQuestionModel_show_description').change(function(){if($(this).val()==0){$description.hide();}\nelse{$description.show();}}).change();}\nvar initTinyMCEField=(function(){var fn=function initDynamicTinyMCEField(field){$(field).tinymce(initDynamicTinyMCEField.options);};fn.options={};return fn;})();function initRounds(options){var localeOptions={nl:{'dateFormat':'dd-mm-yy','hourGrid':6,'minuteGrid':15,'timeFormat':'hh:mm','changeMonth':true,'changeYear':true,'timeOnlyTitle':'Kies de tijd','timeText':'Tijd','hourText':'Uur','closeText':'Ok','minuteText':'Minuut','secondText':'Seconde'},en:{'dateFormat':'dd-mm-yy','hourGrid':6,'minuteGrid':15,'timeFormat':'hh:mm','changeMonth':true,'changeYear':true,'timeOnlyTitle':'Choose Time','timeText':'Time','hourText':'Hour','closeText':'Ok','minuteText':'Minute','secondText':'Second'}};var _initPickers=function(){$(\".datepicker\").datetimepicker($.extend({showMonthAfterYear:false},$.datepicker.regional[options.lang],localeOptions[options.lang]));};_initPickers();$(\".row.inputs\").on('click','.remove:not(.disabled)',function(e){e.preventDefault();$(this).parents('div.row:first').remove();});$(\".button.add:not(.disabled)\").on('click',function(){var translate={'{idx}':$(\".row.inputs > div\").length,};$(\".row.inputs\").append(options.inputTemplate.replace(/\\{[a-zA-Z_]+}/g,function(a){return translate[a]||'';}));_initPickers();});}\nfunction initUserManagement()\n{$(\"#tabs\").tabs();$('.csv-import').hide();$('.import-user').hide();$('.show-test-email').on('click',function(e){e.preventDefault();$('.buttons-container').hide(200);$('.test-email').show(200);});$('.show-csv-import').on('click',function(e){e.preventDefault();$('.csv-import').show(200);$('.import-buttons').hide(200);});$('.show-import-user').on('click',function(e){e.preventDefault();$('.import-user').show(200);$('.import-buttons').hide(200);});$('.cancel-import').on('click',function(e){e.preventDefault();$('.csv-import').hide(200);$('.import-user').hide(200);$('.import-buttons').show(200);});}\nfunction initCourseElementIndex(options){$(\".showsubtypes\").click(function(e){e.preventDefault();$(this).hide();$(\".subtypes\").show();});$(\".subtypes .cancel\").click(function(e){e.preventDefault();$(\".subtypes\").hide();$(\".showsubtypes\").show();});$('[data-confirm]').click(function(e){if(!confirm($(this).data('confirm'))){e.preventDefault();}});$container=$(\".courselist\");$container.sortable({items:\"li:not(.unsortable)\",placeholder:\"ui-sortable-placeholder\",axis:\"y\",update:function(){var data=$container.sortable('serialize');$.ajax({url:options.updateSortUrl,type:'post',data:data,success:function(){var number=1;$('li.courseitem span.step',$container).each(function(){$(this).html(number++);});},error:function(){alert(options.error);}})}});$(\".courselist\").disableSelection();}\nfunction initPageLeave(message){window.onbeforeunload=function(){if($('form:first input[type=\\\"text\\\"][value!=\\\"\\\"], form:first textarea[value!=\\\"\\\"]').size()==0){return;}\nreturn message;}\n$('form').submit(function(){window.onbeforeunload=null;});$('.previewaction .button, .facebbutton').click(function(){window.onbeforeunload=null;});}\nfunction tinyMceCustom(ed){tinymce.PluginManager.add('qwmedia',function(editor,url){var urlPatterns=[{regex:/youtu\\.be\\/([\\w\\-.]+)/,type:'iframe',w:425,h:350,url:'//www.youtube.com/embed/$1'},{regex:/youtube\\.com(.+)v=([^&]+)/,type:'iframe',w:425,h:350,url:'//www.youtube.com/embed/$2'},{regex:/vimeo\\.com\\/([0-9]+)/,type:'iframe',w:425,h:350,url:'//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc'},{regex:/vimeo\\.com\\/(.*)\\/([0-9]+)/,type:\"iframe\",w:425,h:350,url:\"//player.vimeo.com/video/$2?title=0&amp;byline=0\"},{regex:/maps\\.google\\.([a-z]{2,3})\\/maps\\/(.+)msid=(.+)/,type:'iframe',w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed\"'}];var embedChange=(tinymce.Env.ie&&tinymce.Env.ie<=8)?'onChange':'onInput';function guessMime(url){if(url.indexOf('.mp3')!=-1){return'audio/mpeg';}\nif(url.indexOf('.wav')!=-1){return'audio/wav';}\nif(url.indexOf('.mp4')!=-1){return'video/mp4';}\nif(url.indexOf('.webm')!=-1){return'video/webm';}\nif(url.indexOf('.ogg')!=-1){return'video/ogg';}\nif(url.indexOf('.swf')!=-1){return'application/x-shockwave-flash';}\nreturn'';}\nfunction getVideoScriptMatch(src){var prefixes=editor.settings.media_scripts;if(prefixes){for(var i=0;i<prefixes.length;i++){if(src.indexOf(prefixes[i].filter)!==-1){return prefixes[i];}}}}\nfunction showDialog(){var win,width,height,data;var generalFormItems=[{name:'source1',type:'filepicker',filetype:'media',size:40,autofocus:true,label:'Source',onchange:function(e){tinymce.each(e.meta,function(value,key){win.find('#'+key).value(value);});}}];function recalcSize(e){var widthCtrl,heightCtrl,newWidth,newHeight;widthCtrl=win.find('#width')[0];heightCtrl=win.find('#height')[0];newWidth=widthCtrl.value();newHeight=heightCtrl.value();if(win.find('#constrain')[0].checked()&&width&&height&&newWidth&&newHeight){if(e.control==widthCtrl){newHeight=Math.round((newWidth/width)*newHeight);heightCtrl.value(newHeight);}else{newWidth=Math.round((newHeight/height)*newWidth);widthCtrl.value(newWidth);}}\nwidth=newWidth;height=newHeight;}\nif(editor.settings.media_alt_source!==false){generalFormItems.push({name:'source2',type:'filepicker',filetype:'media',size:40,label:'Alternative source'});}\nif(editor.settings.media_poster!==false){generalFormItems.push({name:'poster',type:'filepicker',filetype:'image',size:40,label:'Poster'});}\nif(editor.settings.media_dimensions!==false){generalFormItems.push({type:'container',label:'Dimensions',layout:'flex',align:'center',spacing:5,items:[{name:'width',type:'textbox',maxLength:3,size:3,onchange:recalcSize},{type:'label',text:'x'},{name:'height',type:'textbox',maxLength:3,size:3,onchange:recalcSize},{name:'constrain',type:'checkbox',checked:true,text:'Constrain proportions'}]});}\ndata=getData(editor.selection.getNode());width=data.width;height=data.height;var embedTextBox={id:'mcemediasource',type:'textbox',flex:1,name:'embed',value:getSource(),multiline:true,label:'Source',minWidth:300,minHeight:100};function updateValueOnChange(){data=htmlToData(this.value());this.parent().parent().fromJSON(data);}\nembedTextBox[embedChange]=updateValueOnChange;win=editor.windowManager.open({title:'Insert/edit video',data:data,body:{title:'Embed',type:\"panel\",layout:'flex',direction:'column',align:'stretch',padding:10,spacing:10,onShowTab:function(){this.find('#embed').value(dataToHtml(this.parent().toJSON()));},items:[{type:'label',text:'Paste your embed code below:',forId:'mcemediasource'},embedTextBox]},onSubmit:function(){var beforeObjects,afterObjects,i,y;beforeObjects=editor.dom.select('img[data-mce-object]');editor.insertContent(dataToHtml(this.toJSON()));afterObjects=editor.dom.select('img[data-mce-object]');for(i=0;i<beforeObjects.length;i++){for(y=afterObjects.length-1;y>=0;y--){if(beforeObjects[i]==afterObjects[y]){afterObjects.splice(y,1);}}}\neditor.selection.select(afterObjects[0]);editor.nodeChanged();}});}\nfunction getSource(){var elm=editor.selection.getNode();if(elm.getAttribute('data-mce-object')){return editor.selection.getContent();}}\nfunction dataToHtml(data){var html='';if(!data.source1){tinymce.extend(data,htmlToData(data.embed));if(!data.source1){return'';}}\nif(!data.source2){data.source2='';}\nif(!data.poster){data.poster='';}\ndata.source1=editor.convertURL(data.source1,\"source\");data.source2=editor.convertURL(data.source2,\"source\");data.source1mime=guessMime(data.source1);data.source2mime=guessMime(data.source2);data.poster=editor.convertURL(data.poster,\"poster\");data.flashPlayerUrl=editor.convertURL(url+'/moxieplayer.swf',\"movie\");tinymce.each(urlPatterns,function(pattern){var match,i,url;if((match=pattern.regex.exec(data.source1))){url=pattern.url;for(i=0;match[i];i++){url=url.replace('$'+i,function(){return match[i];});}\ndata.source1=url;data.type=pattern.type;data.width=data.width||pattern.w;data.height=data.height||pattern.h;}});if(data.embed){html=updateHtml(data.embed,data,true);}else{var videoScript=getVideoScriptMatch(data.source1);if(videoScript){data.type='script';data.width=videoScript.width;data.height=videoScript.height;}\ndata.width=data.width||300;data.height=data.height||150;tinymce.each(data,function(value,key){data[key]=editor.dom.encode(value);});if(data.type==\"iframe\"){html+='<iframe src=\"'+data.source1+'\" width=\"'+data.width+'\" height=\"'+data.height+'\"></iframe>';}else if(data.source1mime==\"application/x-shockwave-flash\"){html+='<object data=\"'+data.source1+'\" width=\"'+data.width+'\" height=\"'+data.height+'\" type=\"application/x-shockwave-flash\">';if(data.poster){html+='<img src=\"'+data.poster+'\" width=\"'+data.width+'\" height=\"'+data.height+'\" />';}\nhtml+='</object>';}else if(data.source1mime.indexOf('audio')!=-1){if(editor.settings.audio_template_callback){html=editor.settings.audio_template_callback(data);}else{html+=('<audio controls=\"controls\" src=\"'+data.source1+'\">'+(data.source2?'\\n<source src=\"'+data.source2+'\"'+(data.source2mime?' type=\"'+data.source2mime+'\"':'')+' />\\n':'')+'</audio>');}}else if(data.type==\"script\"){html+='\u003cscript src=\"'+data.source1+'\"><\/script>';}else{if(editor.settings.video_template_callback){html=editor.settings.video_template_callback(data);}else{html=('<video width=\"'+data.width+'\" height=\"'+data.height+'\"'+(data.poster?' poster=\"'+data.poster+'\"':'')+' controls=\"controls\">\\n'+'<source src=\"'+data.source1+'\"'+(data.source1mime?' type=\"'+data.source1mime+'\"':'')+' />\\n'+(data.source2?'<source src=\"'+data.source2+'\"'+(data.source2mime?' type=\"'+data.source2mime+'\"':'')+' />\\n':'')+'</video>');}}}\nreturn html;}\nfunction htmlToData(html){var data={};new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:'script,noscript',start:function(name,attrs){if(!data.source1&&name==\"param\"){data.source1=attrs.map.movie;}\nif(name==\"iframe\"||name==\"object\"||name==\"embed\"||name==\"video\"||name==\"audio\"){if(!data.type){data.type=name;}\ndata=tinymce.extend(attrs.map,data);}\nif(name==\"script\"){var videoScript=getVideoScriptMatch(attrs.map.src);if(!videoScript){return;}\ndata={type:\"script\",source1:attrs.map.src,width:videoScript.width,height:videoScript.height};}\nif(name==\"source\"){if(!data.source1){data.source1=attrs.map.src;}else if(!data.source2){data.source2=attrs.map.src;}}\nif(name==\"img\"&&!data.poster){data.poster=attrs.map.src;}}}).parse(html);data.source1=data.source1||data.src||data.data;data.source2=data.source2||'';data.poster=data.poster||'';return data;}\nfunction getData(element){if(element.getAttribute('data-mce-object')){return htmlToData(editor.serializer.serialize(element,{selection:true}));}\nreturn{};}\nfunction sanitize(html){if(editor.settings.media_filter_html===false){return html;}\nvar writer=new tinymce.html.Writer();new tinymce.html.SaxParser({validate:false,allow_conditional_comments:false,special:'script,noscript',comment:function(text){writer.comment(text);},cdata:function(text){writer.cdata(text);},text:function(text,raw){writer.text(text,raw);},start:function(name,attrs,empty){if(name=='script'||name=='noscript'){return;}\nfor(var i=0;i<attrs.length;i++){if(attrs[i].name.indexOf('on')===0){return;}}\nwriter.start(name,attrs,empty);},end:function(name){if(name=='script'||name=='noscript'){return;}\nwriter.end(name);}},new tinymce.html.Schema({})).parse(html);return writer.getContent();}\nfunction updateHtml(html,data,updateAll){var writer=new tinymce.html.Writer();var sourceCount=0,hasImage;function setAttributes(attrs,updatedAttrs){var name,i,value,attr;for(name in updatedAttrs){value=\"\"+updatedAttrs[name];if(attrs.map[name]){i=attrs.length;while(i--){attr=attrs[i];if(attr.name==name){if(value){attrs.map[name]=value;attr.value=value;}else{delete attrs.map[name];attrs.splice(i,1);}}}}else if(value){attrs.push({name:name,value:value});attrs.map[name]=value;}}}\nnew tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:'script,noscript',comment:function(text){writer.comment(text);},cdata:function(text){writer.cdata(text);},text:function(text,raw){writer.text(text,raw);},start:function(name,attrs,empty){switch(name){case\"video\":case\"object\":case\"embed\":case\"img\":case\"iframe\":setAttributes(attrs,{width:data.width,height:data.height});break;}\nif(updateAll){switch(name){case\"video\":setAttributes(attrs,{poster:data.poster,src:\"\"});if(data.source2){setAttributes(attrs,{src:\"\"});}\nbreak;case\"iframe\":setAttributes(attrs,{src:data.source1});break;case\"source\":sourceCount++;if(sourceCount<=2){setAttributes(attrs,{src:data[\"source\"+sourceCount],type:data[\"source\"+sourceCount+\"mime\"]});if(!data[\"source\"+sourceCount]){return;}}\nbreak;case\"img\":if(!data.poster){return;}\nhasImage=true;break;}}\nwriter.start(name,attrs,empty);},end:function(name){if(name==\"video\"&&updateAll){for(var index=1;index<=2;index++){if(data[\"source\"+index]){var attrs=[];attrs.map={};if(sourceCount<index){setAttributes(attrs,{src:data[\"source\"+index],type:data[\"source\"+index+\"mime\"]});writer.start(\"source\",attrs,true);}}}}\nif(data.poster&&name==\"object\"&&updateAll&&!hasImage){var imgAttrs=[];imgAttrs.map={};setAttributes(imgAttrs,{src:data.poster,width:data.width,height:data.height});writer.start(\"img\",imgAttrs,true);}\nwriter.end(name);}},new tinymce.html.Schema({})).parse(html);return writer.getContent();}\neditor.on('ResolveName',function(e){var name;if(e.target.nodeType==1&&(name=e.target.getAttribute(\"data-mce-object\"))){e.name=name;}});editor.on('preInit',function(){var specialElements=editor.schema.getSpecialElements();tinymce.each('video audio iframe object'.split(' '),function(name){specialElements[name]=new RegExp('<\\/'+name+'[^>]*>','gi');});var boolAttrs=editor.schema.getBoolAttrs();tinymce.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '),function(name){boolAttrs[name]={};});editor.parser.addNodeFilter('iframe,video,audio,object,embed,script',function(nodes,name){var i=nodes.length,ai,node,placeHolder,attrName,attrValue,attribs,innerHtml;var videoScript;while(i--){node=nodes[i];if(!node.parent){continue;}\nif(node.name=='script'){videoScript=getVideoScriptMatch(node.attr('src'));if(!videoScript){continue;}}\nplaceHolder=new tinymce.html.Node('img',1);placeHolder.shortEnded=true;if(videoScript){if(videoScript.width){node.attr('width',videoScript.width.toString());}\nif(videoScript.height){node.attr('height',videoScript.height.toString());}}\nattribs=node.attributes;ai=attribs.length;while(ai--){attrName=attribs[ai].name;attrValue=attribs[ai].value;if(attrName!==\"width\"&&attrName!==\"height\"&&attrName!==\"style\"){if(attrName==\"data\"||attrName==\"src\"){attrValue=editor.convertURL(attrValue,attrName);}\nplaceHolder.attr('data-mce-p-'+attrName,attrValue);}}\ninnerHtml=node.firstChild&&node.firstChild.value;if(innerHtml){placeHolder.attr(\"data-mce-html\",escape(innerHtml));placeHolder.firstChild=null;}\nplaceHolder.attr({width:node.attr('width')||\"300\",height:node.attr('height')||(name==\"audio\"?\"30\":\"150\"),style:node.attr('style'),src:tinymce.Env.transparentSrc,\"data-mce-object\":name,\"class\":\"mce-object mce-object-\"+name});node.replace(placeHolder);}});editor.serializer.addAttributeFilter('data-mce-object',function(nodes,name){var i=nodes.length,node,realElm,ai,attribs,innerHtml,innerNode,realElmName;while(i--){node=nodes[i];if(!node.parent){continue;}\nrealElmName=node.attr(name);realElm=new tinymce.html.Node(realElmName,1);if(realElmName!=\"audio\"&&realElmName!=\"script\"){realElm.attr({width:node.attr('width'),height:node.attr('height')});}\nrealElm.attr({style:node.attr('style')});attribs=node.attributes;ai=attribs.length;while(ai--){var attrName=attribs[ai].name;if(attrName.indexOf('data-mce-p-')===0){realElm.attr(attrName.substr(11),attribs[ai].value);}}\nif(realElmName==\"script\"){realElm.attr('type','text/javascript');}\ninnerHtml=node.attr('data-mce-html');if(innerHtml){innerNode=new tinymce.html.Node('#text',3);innerNode.raw=true;innerNode.value=sanitize(unescape(innerHtml));realElm.append(innerNode);}\nnode.replace(realElm);}});});editor.on('ObjectSelected',function(e){var objectType=e.target.getAttribute('data-mce-object');if(objectType==\"audio\"||objectType==\"script\"){e.preventDefault();}});editor.on('objectResized',function(e){var target=e.target,html;if(target.getAttribute('data-mce-object')){html=target.getAttribute('data-mce-html');if(html){html=unescape(html);target.setAttribute('data-mce-html',escape(updateHtml(html,{width:e.width,height:e.height})));}}});editor.addButton('media',{tooltip:'Insert/edit video',onclick:showDialog,stateSelector:['img[data-mce-object=video]','img[data-mce-object=iframe]']});editor.addMenuItem('media',{icon:'media',text:'Insert video',onclick:showDialog,context:'insert',prependToContext:true});});}";
